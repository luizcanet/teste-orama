<!DOCTYPE html>
<html ng-app="investmentFunds">
  <head>
    <meta charset="utf-8" />
    <title>Teste Órama</title>
    <link rel="stylesheet" href="styles/main.css" />
    <script src="node_modules/angular/angular.js"></script>
    <script src="node_modules/angular-resource/angular-resource.js"></script>
    <script src="node_modules/angular-filter/dist/angular-filter.js"></script>
    <script src="node_modules/angular-i18n/angular-locale_pt-br.js"></script>
    <script src="investment-funds.module.js"></script>
    <script src="investment-funds.service.js"></script>
    <script src="investment-funds.controller.js"></script>
  </head>

  <body ng-controller="InvestmentFundsController">
    <div>
      <input type="text" placeholder="Buscar fundo por nome" ng-model="search.simple_name" />
    </div>
    <div>
      <label>Aplicação mínima</label>
      <input
        type="range"
        min="0"
        max="50000"
        step="100"
        ng-model="range.operability.minimum_initial_application_amount" />
      <div>
        Até R$ {{ range.operability.minimum_initial_application_amount | number: 0 }}
      </div>
    </div>
    <div>
      <label>Perfil de risco do fundo</label>
      <div>
        <button type="button" ng-repeat="n in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]" ng-click="range.specification.fund_risk_profile.score_range_order = n">
          Nível {{ n }}
        </button>
      </div>
      <div>
        menor
        <input
          type="range"
          min="1"
          max="12"
          ng-model="range.specification.fund_risk_profile.score_range_order" />
        maior
      </div>
    </div>
    <div>
      <label>Prazo de resgate</label>
      <input
      type="range"
      min="0"
      max="365"
      ng-model="range.operability.retrieval_quotation_days" />
      <div>
        Até {{ range.operability.retrieval_quotation_days }} dias úteis
      </div>
    </div>
    <div>
      Horário limite de aplicação: 12:00
    </div>

    <div ng-repeat="(strategyName, funds) in funds | filter:search | filter:range:isLessThanOrEqualTo | groupBy: 'specification.fund_macro_strategy.name'" ng-model="strategy">
      <h2>
        <input type="checkbox" ng-model="strategy.selectAll" ng-click="strategy.selectAll=strategy.selectAll" />
        <span ng-click="strategy.showClassList=!strategy.showClassList">
          {{ strategyName }}
        </span>
      </h2>
      <div ng-show="strategy.showClassList">
        <div ng-repeat="(class, funds) in funds | groupBy: 'specification.fund_class'">
          <input type="checkbox" ng-model="selectedClasses[class]" ng-checked="strategy.selectAll" ng-click="strategy.selectAll=false; selectedClasses[class]=selectedClasses[class]" />{{ class }}
        </div>
      </div>
    </div>

    <div ng-model="fundManagers">
      <h2>
        <input type="checkbox" ng-model="fundManagers.selectAll" />
        <span ng-click="fundManagers.showManagerList=!strategy.showManagerList">
          Gestores
        </span>
      </h2>
      <div ng-show="fundManagers.showManagerList">
        <div ng-repeat="(fundManagerName, funds) in funds | filter:search | filter:range:isLessThanOrEqualTo | groupBy: 'fund_manager.name'">
          <input type="checkbox" ng-model="selectedManagers[fundManagerName]" ng-checked="fundManagers.selectAll" />{{ fundManagerName }}
        </div>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Fundo</th>
          <th>Data da cota</th>
          <th>Mes (%)</th>
          <th>2019 (%)</th>
          <th>12 M (%)</th>
          <th>Aplicação mínima (R$)</th>
          <th>Prazo do resgate</th>
          <th>Aplicar</th>
        </tr>
      </thead>
      <tbody ng-repeat="(strategyName, funds) in funds | filter:search | filter:range:isLessThanOrEqualTo | filter:isInselectedClasses | filter:isInselectedManagers | groupBy: 'specification.fund_macro_strategy.name'">
        <tr>
          <th colspan="8">
            <h2>{{ strategyName }}</h2>
          </th>
        </tr>
        <tr ng-repeat-start="(class, funds) in funds | groupBy: 'specification.fund_class'">
          <th colspan="8">
            <h3>{{ class }}</h3>
          </th>
        </tr>
        <tr ng-repeat-start="fund in funds" ng-click="fund.showDetail=!fund.showDetail">
          <th>
            {{ fund.simple_name }}
            <span ng-if="fund.specification.is_qualified">
              Fundo para investidor qualificado
            </span>
            <br />
            <small>{{ strategy }} | {{ class }}</small>
          </th>
          <td>
            {{ fund.initial_date | date: 'dd/MM/yyyy' }}
          </td>
          <td>
            {{ fund.profitabilities.month * 100 | number: 2 }}
          </td>
          <td>
            {{ fund.profitabilities.year * 100 | number: 2 }}
          </td>
          <td>
            {{ fund.profitabilities.m12 * 100 | number: 2 }}
          </td>
          <td>
            {{ fund.operability.minimum_initial_application_amount | number: 2 }}
          </td>
          <td>
            {{ fund.operability.retrieval_quotation_days_str }}
          </td>
          <td>
            <button type="button">Aplicar</button>
          </td>
        </tr>
        <tr ng-repeat-end ng-show="fund.showDetail">
          <td>
            <p>
              <b>Cotização da aplicação:</b>
              {{ fund.operability.application_quotation_days_str }}
            </p>
            <p>
              <b>Cotização do resgate:</b>
              {{ fund.operability.retrieval_quotation_days_str }}
            </p>
            <p>
              <b>Liquidação do resgate:</b>
              {{ fund.operability.retrieval_liquidation_days_str }}
            </p>
            <p>
              <b>Taxa de administração:</b>
              {{ fund.fees.administration_fee }}
            </p>
            <a href="#{{fund.slug}}">
              Conheça mais informações sobre este fundo
            </a>
            <p>
              <b>CNPJ:</b>
              {{ fund.cnpj }}
            </p>
          </td>
        </tr>
        <tr ng-repeat-end>
        </tr>
      </tbody>
    </table>
  </body>
</html>
